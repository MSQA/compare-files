<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ja"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CompareFilesOption.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Compare Files</a> &gt; <a href="index.source.html" class="el_package">me.suwash.tools.comparefiles.main</a> &gt; <span class="el_source">CompareFilesOption.java</span></div><h1>CompareFilesOption.java</h1><pre class="source lang-java linenums">package me.suwash.tools.comparefiles.main;

import java.util.ArrayList;
import java.util.List;

import lombok.Getter;
import me.suwash.tools.comparefiles.infra.config.CompareFilesConfig;

import org.apache.commons.lang3.StringUtils;

import com.beust.jcommander.Parameter;

/**
 * コマンドラインオプション。
 */
@Getter
<span class="fc" id="L17">public class CompareFilesOption {</span>

    /** 設定ファイルパス。 */
    @Parameter(names = {&quot;-config&quot;, &quot;--configFile&quot;})
    private String configFilePath;

    /** workディレクトリを削除するか。 */
    @Parameter(names = {&quot;-d&quot;, &quot;--deleteWorkDir&quot;})
<span class="fc" id="L25">    private boolean isDeleteWorkDir;</span>

    /** 入力ファイル文字コード。 */
    @Parameter(names = {&quot;-ic&quot;, &quot;--inputCharset&quot;})
    private String inputCharset;

    /** 入力ファイルがソート済か。 */
    @Parameter(names = {&quot;-s&quot;, &quot;--sorted&quot;})
<span class="fc" id="L33">    private boolean isSorted;</span>

    /** CSV/TSVヘッダー行。 */
    @Parameter(names = {&quot;-ch&quot;, &quot;--csvHeaderRow&quot;})
<span class="fc" id="L37">    private int csvHeaderRow;</span>

    /** CSV/TSVデータ開始行。 */
    @Parameter(names = {&quot;-cd&quot;, &quot;--csvDataStartRow&quot;})
<span class="fc" id="L41">    private int csvDataStartRow;</span>

    /** 出力ディレクトリ。 */
    @Parameter(names = {&quot;-od&quot;, &quot;--outputDir&quot;})
<span class="fc" id="L45">    private String outputDir;</span>

    /** 出力ファイル名。 */
    @Parameter(names = {&quot;-of&quot;, &quot;--compareResultFileName&quot;})
<span class="fc" id="L49">    private String compareResultFileName;</span>

    /** 出力文字コード。 */
    @Parameter(names = {&quot;-oc&quot;, &quot;--outputCharset&quot;})
<span class="fc" id="L53">    private String outputCharset;</span>

    /** 詳細出力ファイル：差分のみ出力するか。 */
    @Parameter(names = {&quot;-wdo&quot;, &quot;--writeDiffOnly&quot;})
<span class="fc" id="L57">    private boolean isWriteDiffOnly;</span>

    /** 詳細出力ファイル：左差分プリフィックス。 */
    @Parameter(names = {&quot;-dpl&quot;, &quot;--leftPrefix&quot;})
<span class="fc" id="L61">    private String leftPrefix;</span>

    /** 詳細出力ファイル：右差分プリフィックス。 */
    @Parameter(names = {&quot;-dpr&quot;, &quot;--rightPrefix&quot;})
<span class="fc" id="L65">    private String rightPrefix;</span>

    /** 詳細出力ファイル：ファイル名プリフィックス。 */
    @Parameter(names = {&quot;-dfp&quot;, &quot;--compareDetailFilePrefix&quot;})
<span class="fc" id="L69">    private String compareDetailFilePrefix;</span>

    /** 出力バッファ行数。 */
    @Parameter(names = {&quot;-chunk&quot;, &quot;--chunkSize&quot;})
<span class="fc" id="L73">    private int chunkSize;</span>

    /** 共通除外項目名リスト。 */
    @Parameter(names = {&quot;-ignore&quot;, &quot;--ignoreItemList&quot;})
<span class="fc" id="L77">    private List&lt;String&gt; ignoreItemList;</span>

    /** 上書きレイアウトファイル配置ディレクトリリスト。 */
    @Parameter(names = {&quot;-layout&quot;, &quot;--overwriteLayoutDir&quot;})
<span class="fc" id="L81">    private String overwriteLayoutDir;</span>

    /** その他のパラメータ。 */
<span class="fc" id="L84">    @Parameter</span>
<span class="fc" id="L85">    private final List&lt;String&gt; paramList = new ArrayList&lt;String&gt;();</span>

    /**
     * 起動パラメータでシステム設定を上書きします。。
     *
     * @param systemConfig システム設定
     */
    protected void overwriteConfig(final CompareFilesConfig systemConfig) {
        // コマンドライン引数で値が設定されている場合、設定を上書き
<span class="fc" id="L94">        final boolean isDeleteWorkDir = this.isDeleteWorkDir();</span>
<span class="fc bfc" id="L95" title="All 2 branches covered.">        if (isDeleteWorkDir) {</span>
<span class="fc" id="L96">            systemConfig.setDeleteWorkDir(isDeleteWorkDir);</span>
        }

<span class="fc" id="L99">        final String inputCharset = this.getInputCharset();</span>
<span class="fc bfc" id="L100" title="All 2 branches covered.">        if (!StringUtils.isEmpty(inputCharset)) {</span>
<span class="fc" id="L101">            systemConfig.setDefaultInputCharset(inputCharset);</span>
        }

<span class="fc" id="L104">        final boolean isSorted = this.isSorted();</span>
<span class="fc bfc" id="L105" title="All 2 branches covered.">        if (isSorted) {</span>
<span class="fc" id="L106">            systemConfig.setSorted(isSorted);</span>
        }

<span class="fc" id="L109">        final int csvHeaderRow = this.getCsvHeaderRow();</span>
<span class="fc bfc" id="L110" title="All 2 branches covered.">        if (csvHeaderRow != 0) {</span>
<span class="fc" id="L111">            systemConfig.setCsvHeaderRow(csvHeaderRow);</span>
        }

<span class="fc" id="L114">        final int csvDataStartRow = this.getCsvDataStartRow();</span>
<span class="fc bfc" id="L115" title="All 2 branches covered.">        if (csvDataStartRow != 0) {</span>
<span class="fc" id="L116">            systemConfig.setCsvDataStartRow(csvDataStartRow);</span>
        }

<span class="fc" id="L119">        final String outputDir = escapeQuote(this.getOutputDir());</span>
<span class="pc bpc" id="L120" title="1 of 2 branches missed.">        if (!StringUtils.isEmpty(outputDir)) {</span>
<span class="fc" id="L121">            systemConfig.setOutputDir(outputDir);</span>
        }

<span class="fc" id="L124">        final String compareResultFileName = escapeQuote(this.getCompareResultFileName());</span>
<span class="fc bfc" id="L125" title="All 2 branches covered.">        if (!StringUtils.isEmpty(compareResultFileName)) {</span>
<span class="fc" id="L126">            systemConfig.setCompareResultFileName(compareResultFileName);</span>
        }

<span class="fc" id="L129">        final String outputCharset = escapeQuote(this.getOutputCharset());</span>
<span class="fc bfc" id="L130" title="All 2 branches covered.">        if (!StringUtils.isEmpty(outputCharset)) {</span>
<span class="fc" id="L131">            systemConfig.setOutputCharset(outputCharset);</span>
        }

<span class="fc" id="L134">        final boolean isWriteDiffOnly = this.isWriteDiffOnly();</span>
<span class="fc bfc" id="L135" title="All 2 branches covered.">        if (isWriteDiffOnly) {</span>
<span class="fc" id="L136">            systemConfig.setWriteDiffOnly(isWriteDiffOnly);</span>
        }

<span class="fc" id="L139">        final String leftPrefix = escapeQuote(this.getLeftPrefix());</span>
<span class="fc bfc" id="L140" title="All 2 branches covered.">        if (!StringUtils.isEmpty(leftPrefix)) {</span>
<span class="fc" id="L141">            systemConfig.setLeftPrefix(leftPrefix);</span>
        }

<span class="fc" id="L144">        final String rightPrefix = escapeQuote(this.getRightPrefix());</span>
<span class="fc bfc" id="L145" title="All 2 branches covered.">        if (!StringUtils.isEmpty(rightPrefix)) {</span>
<span class="fc" id="L146">            systemConfig.setRightPrefix(rightPrefix);</span>
        }

<span class="fc" id="L149">        final String compareDetailFilePrefix = escapeQuote(this.getCompareDetailFilePrefix());</span>
<span class="fc bfc" id="L150" title="All 2 branches covered.">        if (!StringUtils.isEmpty(compareDetailFilePrefix)) {</span>
<span class="fc" id="L151">            systemConfig.setCompareDetailFilePrefix(compareDetailFilePrefix);</span>
        }

<span class="fc" id="L154">        final int chunkSize = this.getChunkSize();</span>
<span class="fc bfc" id="L155" title="All 2 branches covered.">        if (chunkSize != 0) {</span>
<span class="fc" id="L156">            systemConfig.setChunkSize(chunkSize);</span>
        }

<span class="fc" id="L159">        final List&lt;String&gt; ignoreItemList = this.getIgnoreItemList();</span>
<span class="pc bpc" id="L160" title="1 of 4 branches missed.">        if (ignoreItemList != null &amp;&amp; !ignoreItemList.isEmpty()) {</span>
<span class="fc" id="L161">            systemConfig.setIgnoreItemList(ignoreItemList);</span>
        }

<span class="fc" id="L164">        final String overwriteLayoutDir = escapeQuote(this.getOverwriteLayoutDir());</span>
<span class="fc bfc" id="L165" title="All 2 branches covered.">        if (!StringUtils.isEmpty(overwriteLayoutDir)) {</span>
<span class="fc" id="L166">            systemConfig.setOverwriteLayoutDir(overwriteLayoutDir);</span>
        }
<span class="fc" id="L168">    }</span>

    /**
     * クォート、ダブルクォートで括られた文字列から、括り文字を除去します。
     *
     * @param string クォート、ダブルクォートで括られた文字列
     * @return 括り文字を除去した文字列
     */
    protected static String escapeQuote(final String string) {
<span class="fc bfc" id="L177" title="All 2 branches covered.">        if (string == null) {</span>
<span class="fc" id="L178">            return null;</span>
        }

//        if (string.charAt(0) == '\'' &amp;&amp; string.charAt(string.length() - 1) == '\'' ||
//            string.charAt(0) == '\&quot;' &amp;&amp; string.charAt(string.length() - 1) == '\&quot;') {
<span class="pc bpc" id="L183" title="1 of 4 branches missed.">        if (string.charAt(0) == '\'' &amp;&amp; string.charAt(string.length() - 1) == '\'') {</span>
<span class="fc" id="L184">            return string.substring(1, string.length() - 1);</span>

        } else {
<span class="fc" id="L187">            return string;</span>
        }
    }

    /**
     * 引数で指定された設定ファイルパスを返します。
     * ※mainクラスから直接アクセスされるため、public公開しています。
     *
     * @return 設定ファイルパス
     */
    protected String getConfigFilePath() {
<span class="fc" id="L198">        return CompareFilesOption.escapeQuote(this.configFilePath);</span>
    }

    /**
     * 引数で指定された入力ファイル文字コードを返します。
     *
     * @return 入力ファイル文字コード
     */
    protected String getInputCharset() {
<span class="fc" id="L207">        return CompareFilesOption.escapeQuote(this.inputCharset);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>