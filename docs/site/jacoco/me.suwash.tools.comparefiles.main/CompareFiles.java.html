<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ja"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CompareFiles.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Compare Files</a> &gt; <a href="index.source.html" class="el_package">me.suwash.tools.comparefiles.main</a> &gt; <span class="el_source">CompareFiles.java</span></div><h1>CompareFiles.java</h1><pre class="source lang-java linenums">package me.suwash.tools.comparefiles.main;

import java.io.File;
import java.util.List;

import me.suwash.ddd.classification.ProcessStatus;
import me.suwash.tools.comparefiles.ap.DirCompareFacade;
import me.suwash.tools.comparefiles.ap.FileCompareFacade;
import me.suwash.tools.comparefiles.ap.dto.DirCompareFacadeInput;
import me.suwash.tools.comparefiles.ap.dto.DirCompareFacadeOutput;
import me.suwash.tools.comparefiles.ap.dto.FileCompareFacadeInput;
import me.suwash.tools.comparefiles.ap.dto.FileCompareFacadeOutput;
import me.suwash.tools.comparefiles.infra.config.CompareFilesConfig;

import org.apache.commons.lang3.StringUtils;

/**
 * CUIバウンダリ。
 */
<span class="fc" id="L20">@lombok.extern.slf4j.Slf4j</span>
public class CompareFiles extends BaseCompareFiles {

    private static final int PARAM_SIZE_NO_CONFIG = 2;

    /**
     * デフォルトコンストラクタ。
     * UTからアクセスできる様にprotected公開しています。
     */
    protected CompareFiles() {
<span class="fc" id="L30">        super();</span>
<span class="fc" id="L31">    }</span>

    /**
     * コマンドラインのエントリポイント。
     *
     * @param args コマンドライン引数
     */
    public static void main(final String... args) {
        // 比較実行
<span class="nc" id="L40">        final CompareFiles instance = new CompareFiles();</span>
<span class="nc" id="L41">        final ProcessStatus processStatus = instance.execute(args);</span>

        // 結果判定
<span class="nc" id="L44">        exitScript(processStatus);</span>
<span class="nc" id="L45">    }</span>

    /*
     * (非 Javadoc)
     * @see me.suwash.tools.comparefiles.main.BaseCompareFiles#isValidParam(me.suwash.tools.comparefiles.main.CompareFilesOption)
     */
    @Override
    protected boolean isValidParam(final CompareFilesOption option) {
<span class="fc" id="L53">        boolean isValid = true;</span>

<span class="fc" id="L55">        final List&lt;String&gt; paramList = option.getParamList();</span>
        // 設定ファイルパスが指定されていない場合、「左パス」「右パス」が指定されていないければエラー
<span class="pc bpc" id="L57" title="1 of 4 branches missed.">        if (StringUtils.isEmpty(option.getConfigFilePath()) &amp;&amp; paramList.size() != PARAM_SIZE_NO_CONFIG) {</span>
<span class="fc" id="L58">            isValid = false;</span>
        }

<span class="fc" id="L61">        return isValid;</span>
    }

    /*
     * (非 Javadoc)
     * @see me.suwash.tools.comparefiles.main.BaseCompareFiles#executeFacade(java.util.List, me.suwash.tools.comparefiles.infra.config.CompareFilesConfig)
     */
    @Override
    protected ProcessStatus executeFacade(final List&lt;String&gt; paramList, final CompareFilesConfig config) {
        // 左パス
<span class="fc" id="L71">        final String leftPath = paramList.get(0);</span>
<span class="fc" id="L72">        final File left = new File(leftPath);</span>

        // 右パス
<span class="fc" id="L75">        final String rightPath = paramList.get(1);</span>
<span class="fc" id="L76">        final File right = new File(rightPath);</span>

        // 出力ディレクトリ
<span class="fc" id="L79">        final String outputDirPath = config.getOutputDir();</span>

        // 実行情報出力
<span class="fc" id="L82">        log.info(&quot;・入力情報&quot;);</span>
<span class="fc" id="L83">        log.info(&quot;  ・左パス                          : &quot; + left.getPath());</span>
<span class="fc" id="L84">        log.info(&quot;  ・右パス                          : &quot; + right.getPath());</span>
<span class="fc" id="L85">        config.printDetails();</span>

        // 比較レイアウト読み込み
<span class="fc" id="L88">        loadLayout(config);</span>

        // 実行
<span class="fc" id="L91">        ProcessStatus processStatus = null;</span>
<span class="fc bfc" id="L92" title="All 2 branches covered.">        if (left.isFile()) {</span>
<span class="fc" id="L93">            final FileCompareFacadeOutput outDto = executeFileFacade(leftPath, rightPath, outputDirPath, config);</span>
<span class="fc" id="L94">            processStatus = outDto.getProcessStatus();</span>
<span class="fc" id="L95">        } else {</span>
<span class="fc" id="L96">            final DirCompareFacadeOutput outDto = executeDirFacade(leftPath, rightPath, outputDirPath, config);</span>
<span class="fc" id="L97">            processStatus = outDto.getProcessStatus();</span>
        }
<span class="fc" id="L99">        return processStatus;</span>
    }

    /**
     * ファイル比較を実行します。
     *
     * @param leftFilePath 左ファイルパス
     * @param rightFilePath 右ファイルパス
     * @param outputDirPath 出力ディレクトリパス
     * @param config システム設定
     * @return 比較結果データモデル
     */
    private FileCompareFacadeOutput executeFileFacade(
        final String leftFilePath,
        final String rightFilePath,
        final String outputDirPath,
        final CompareFilesConfig config) {

<span class="fc" id="L117">        log.info(&quot;  ・比較モード                      : ファイル比較&quot;);</span>

        // Facade呼出し
<span class="fc" id="L120">        final FileCompareFacadeInput inDto = new FileCompareFacadeInput();</span>
<span class="fc" id="L121">        inDto.setLeftFilePath(leftFilePath);</span>
<span class="fc" id="L122">        inDto.setRightFilePath(rightFilePath);</span>
<span class="fc" id="L123">        inDto.setOutputDir(outputDirPath);</span>
<span class="fc" id="L124">        inDto.setConfig(config);</span>
<span class="fc" id="L125">        final FileCompareFacadeOutput outDto = new FileCompareFacade().execute(inDto);</span>

        // 結果出力
<span class="fc" id="L128">        outDto.printDetails();</span>
<span class="fc" id="L129">        return outDto;</span>
    }

    /**
     * ディレクトリ比較を実行します。
     *
     * @param leftDirPath 左ディレクトリパス
     * @param rightDirPath 右ディレクトリパス
     * @param outputDirPath 出力ディレクトリパス
     * @param config システム設定
     * @return 比較結果データモデル
     */
    private DirCompareFacadeOutput executeDirFacade(final String leftDirPath, final String rightDirPath, final String outputDirPath, final CompareFilesConfig config) {
<span class="fc" id="L142">        log.info(&quot;  ・比較モード                      : ディレクトリ比較&quot;);</span>

        // Facade呼出し
<span class="fc" id="L145">        final DirCompareFacadeInput inDto = new DirCompareFacadeInput();</span>
<span class="fc" id="L146">        inDto.setLeftDirPath(leftDirPath);</span>
<span class="fc" id="L147">        inDto.setRightDirPath(rightDirPath);</span>
<span class="fc" id="L148">        inDto.setOutputDir(outputDirPath);</span>
<span class="fc" id="L149">        inDto.setConfig(config);</span>
<span class="fc" id="L150">        final DirCompareFacadeOutput outDto = new DirCompareFacade().execute(inDto);</span>

        // 結果出力
<span class="fc" id="L153">        outDto.printDetails();</span>
<span class="fc" id="L154">        return outDto;</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.6.201602180812</span></div></body></html>